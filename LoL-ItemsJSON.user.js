// ==UserScript==
// @name        LoL-ItemsJSON
// @version     10.25.1a
// @author      EagleExe
// @include     https://mobafire.com/league-of-legends/build/*
// @include     https://www.mobafire.com/league-of-legends/build/*
// @include     https://probuilds.net/guide/show/*
// @include     https://www.probuilds.net/guide/show/*
// ==/UserScript==

document.ItemCodes = {"Boots":1001,"Faerie Charm":1004,"Rejuvenation Bead":1006,"Giant's Belt":1011,"Cloak of Agility":1018,"Blasting Wand":1026,"Sapphire Crystal":1027,"Ruby Crystal":1028,"Cloth Armor":1029,"Chain Vest":1031,"Null-Magic Mantle":1033,"Emberknife":1035,"Long Sword":1036,"Pickaxe":1037,"B. F. Sword":1038,"Hailblade":1039,"Dagger":1042,"Recurve Bow":1043,"Amplifying Tome":1052,"Vampiric Scepter":1053,"Doran's Shield":1054,"Doran's Blade":1055,"Doran's Ring":1056,"Negatron Cloak":1057,"Needlessly Large Rod":1058,"Dark Seal":1082,"Cull":1083,"Health Potion":2003,"Total Biscuit of Everlasting Will":2010,"Kircheis Shard":2015,"Refillable Potion":2031,"Corrupting Potion":2033,"Guardian's Horn":2051,"Poro-Snax":2052,"Control Ward":2055,"Shurelya's Battlesong":2065,"Elixir of Iron":2138,"Elixir of Sorcery":2139,"Elixir of Wrath":2140,"Minion Dematerializer":2403,"Commencing Stopwatch":2419,"Stopwatch":2420,"Broken Stopwatch":2421,"Slightly Magical Footwear":2422,"Perfectly Timed Stopwatch":2423,"Broken Stopwatch":2424,"Abyssal Mask":3001,"Archangel's Staff":3003,"Manamune":3004,"Berserker's Greaves":3006,"Boots of Swiftness":3009,"Chemtech Putrifier":3011,"Sorcerer's Shoes":3020,"Glacial Buckler":3024,"Guardian Angel":3026,"Infinity Edge":3031,"Mortal Reminder":3033,"Last Whisper":3035,"Lord Dominik's Regards":3036,"Seraph's Embrace":3040,"Mejai's Soulstealer":3041,"Muramana":3042,"Muramana":3043,"Phage":3044,"Phantom Dancer":3046,"Plated Steelcaps":3047,"Seraph's Embrace":3048,"Zeke's Convergence":3050,"Hearthbound Axe":3051,"Sterak's Gage":3053,"Sheen":3057,"Spirit Visage":3065,"Winged Moonplate":3066,"Kindlegem":3067,"Sunfire Aegis":3068,"Tear of the Goddess":3070,"Black Cleaver":3071,"Bloodthirster":3072,"Ravenous Hydra":3074,"Thornmail":3075,"Bramble Vest":3076,"Tiamat":3077,"Trinity Force":3078,"Warden's Mail":3082,"Warmog's Armor":3083,"Runaan's Hurricane":3085,"Zeal":3086,"Rabadon's Deathcap":3089,"Wit's End":3091,"Rapid Firecannon":3094,"Stormrazor":3095,"Lich Bane":3100,"Banshee's Veil":3102,"Aegis of the Legion":3105,"Redemption":3107,"Fiendish Codex":3108,"Knight's Vow":3109,"Frozen Heart":3110,"Mercury's Treads":3111,"Guardian's Orb":3112,"Aether Wisp":3113,"Forbidden Idol":3114,"Nashor's Tooth":3115,"Rylai's Crystal Scepter":3116,"Mobility Boots":3117,"Executioner's Calling":3123,"Guinsoo's Rageblade":3124,"Caulfield's Warhammer":3133,"Serrated Dirk":3134,"Void Staff":3135,"Mercurial Scimitar":3139,"Quicksilver Sash":3140,"Youmuu's Ghostblade":3142,"Randuin's Omen":3143,"Hextech Alternator":3145,"Hextech Rocketbelt":3152,"Blade of The Ruined King":3153,"Hexdrinker":3155,"Maw of Malmortius":3156,"Zhonya's Hourglass":3157,"Ionian Boots of Lucidity":3158,"Morellonomicon":3165,"Guardian's Blade":3177,"Umbral Glaive":3179,"Sanguine Blade":3181,"Guardian's Hammer":3184,"Locket of the Iron Solari":3190,"Seeker's Armguard":3191,"Gargoyle Stoneplate":3193,"Spectre's Cowl":3211,"Mikael's Blessing":3222,"Scarecrow Effigy":3330,"Stealth Ward":3340,"Farsight Alteration":3363,"Oracle Lens":3364,"Your Cut":3400,"Ardent Censer":3504,"Essence Reaver":3508,"Eye of the Herald":3513,"Kalista's Black Spear":3599,"Kalista's Black Spear":3600,"Dead Man's Plate":3742,"Titanic Hydra":3748,"Crystalline Bracer":3801,"Lost Chapter":3802,"Edge of Night":3814,"Spellthief's Edge":3850,"Frostfang":3851,"Shard of True Ice":3853,"Steel Shoulderguards":3854,"Runesteel Spaulders":3855,"Pauldrons of Whiterock":3857,"Relic Shield":3858,"Targon's Buckler":3859,"Bulwark of the Mountain":3860,"Spectral Sickle":3862,"Harrowing Crescent":3863,"Black Mist Scythe":3864,"Oblivion Orb":3916,"Imperial Mandate":4005,"Force of Nature":4401,"The Golden Spatula":4403,"Horizon Focus":4628,"Cosmic Drive":4629,"Blighting Jewel":4630,"Verdant Barrier":4632,"Riftmaker":4633,"Leeching Leer":4635,"Night Harvester":4636,"Demonic Embrace":4637,"Watchful Wardstone":4638,"Stirring Wardstone":4641,"Bandleglass Mirror":4642,"Vigilant Wardstone":4643,"Ironspike Whip":6029,"Silvermere Dawn":6035,"Death's Dance":6333,"Chempunk Chainsword":6609,"Staff of Flowing Water":6616,"Moonstone Renewer":6617,"Goredrinker":6630,"Stridebreaker":6631,"Divine Sunderer":6632,"Liandry's Anguish":6653,"Luden's Tempest":6655,"Everfrost":6656,"Bami's Cinder":6660,"Frostfire Gauntlet":6662,"Turbo Chemtank":6664,"Noonquiver":6670,"Galeforce":6671,"Kraken Slayer":6672,"Immortal Shieldbow":6673,"Navori Quickblades":6675,"The Collector":6676,"Rageknife":6677,"Duskblade of Draktharr":6691,"Eclipse":6692,"Prowler's Claw":6693,"Serylda's Grudge":6694,"Serpent's Fang":6695,"Botas":1001,"Amuleto de las hadas":1004,"Perla de rejuvenecimiento":1006,"Cinturón de gigante":1011,"Capa de agilidad":1018,"Vara explosiva":1026,"Cristal de zafiro":1027,"Cristal de rubí":1028,"Armadura de tela":1029,"Chaleco de cadenas":1031,"Manto de anulación de magia":1033,"Cuchillo de ascuas":1035,"Espada larga":1036,"Pico":1037,"Espadón":1038,"Espada de granizo":1039,"Daga":1042,"Arco curvo":1043,"Tomo amplificador":1052,"Cetro vampírico":1053,"Escudo de Doran":1054,"Espada de Doran":1055,"Anillo de Doran":1056,"Capa negatrón":1057,"Vara innecesariamente grande":1058,"Sello oscuro":1082,"Preferencia":1083,"Poción de vida":2003,"Galleta de la voluntad eterna":2010,"Fragmento de Kircheis":2015,"Poción reutilizable":2031,"Poción de corrupción":2033,"Cuerno del guardián":2051,"Snack para poros":2052,"Guardián de control":2055,"Canción de batalla de Shurelya":2065,"Elixir de hierro":2138,"Elixir de brujería":2139,"Elixir de cólera":2140,"Desmaterializador de súbditos":2403,"Cronómetro iniciado":2419,"Cronómetro":2420,"Cronómetro estropeado":2421,"Calzado ligeramente mágico":2422,"Cronómetro oportuno":2423,"Cronómetro estropeado":2424,"Máscara abisal":3001,"Bastón del arcángel":3003,"Manamune":3004,"Grebas de berserker":3006,"Botas de rapidez":3009,"Putrificador tecnoquímico":3011,"Botas de hechicero":3020,"Broquel glacial":3024,"Ángel de la guarda":3026,"Filo infinito":3031,"Recordatorio letal":3033,"Últimas palabras":3035,"Recuerdos de lord Dominik":3036,"Abrazo del serafín":3040,"Robaalmas de Mejai":3041,"Muramana":3042,"Muramana":3043,"Bacteriófago":3044,"Bailarín espectral":3046,"Botas blindadas":3047,"Abrazo del serafín":3048,"Convergencia de Zeke":3050,"Hacha hogareña":3051,"Calibrador de Sterak":3053,"Brillo":3057,"Rostro espiritual":3065,"Armadura lunar alada":3066,"Gema avivadora":3067,"Égida de fuego solar":3068,"Lágrima de la diosa":3070,"Cuchilla negra":3071,"Sanguinaria":3072,"Hidra voraz":3074,"Malla de espinas":3075,"Chaleco de zarzas":3076,"Tiamat":3077,"Fuerza de trinidad":3078,"Malla del guardián":3082,"Armadura de Warmog":3083,"Huracán de Runaan":3085,"Fervor":3086,"Sombrero mortal de Rabadon":3089,"Final del ingenio":3091,"Cañón de fuego rápido":3094,"Navaja de asalto":3095,"Perdición del liche":3100,"Velo del hada de la muerte":3102,"Protección de la legión":3105,"Redención":3107,"Códice diabólico":3108,"Promesa de caballero":3109,"Corazón de hielo":3110,"Botas de mercurio":3111,"Orbe del guardián":3112,"Brisa de éter":3113,"Ídolo prohibido":3114,"Diente de Nashor":3115,"Cetro de cristal de Rylai":3116,"Botas de movilidad":3117,"Llamada del verdugo":3123,"Hoja de furia de Guinsoo":3124,"Martillo de guerra de Caulfield":3133,"Daga dentada":3134,"Bastón del Vacío":3135,"Cimitarra mercurial":3139,"Fajín de mercurio":3140,"Filo fantasmal de Youmuu":3142,"Presagio de Randuin":3143,"Alternador hextech":3145,"Cintomisil hextech":3152,"Hoja del rey arruinado":3153,"Sorbemaleficios":3155,"Fauces de Malmortius":3156,"Reloj de arena de Zhonya":3157,"Botas jonias de la lucidez":3158,"Morellonomicón":3165,"Espada del guardián":3177,"Guja sombría":3179,"Hoja carmesí":3181,"Martillo del guardián":3184,"Medallón de los Solari de Hierro":3190,"Brazalete de la buscadora":3191,"Protector pétreo de gárgola":3193,"Hábito del espectro":3211,"Bendición de Mikael":3222,"Figura de espantapájaros":3330,"Guardián invisible":3340,"Visión lejana modificada":3363,"Lente del oráculo":3364,"Tu parte":3400,"Incensario ardiente":3504,"Segador de esencia":3508,"Ojo del Heraldo":3513,"La lanza negra de Kalista":3599,"La lanza negra de Kalista":3600,"Coraza del muerto":3742,"Hidra titánica":3748,"Brazal cristalino":3801,"Capítulo perdido":3802,"Filo de la noche":3814,"Daga de hechicero":3850,"Colmillo de escarcha":3851,"Fragmento de Hielo Puro":3853,"Hombreras de acero":3854,"Hombreras de acero rúnico":3855,"Hombreras de Rocablanca":3857,"Escudo reliquia":3858,"Broquel de Targon":3859,"Baluarte de la montaña":3860,"Hoz espectral":3862,"Creciente de Harrowing":3863,"Guadaña de la Niebla Negra":3864,"Orbe del olvido":3916,"Mandato imperial":4005,"Fuerza de la naturaleza":4401,"Espátula dorada":4403,"Precisión infalible":4628,"Impulso cósmico":4629,"Joya de la plaga":4630,"Barrera frondosa":4632,"Creagrietas":4633,"Lapa maliciosa":4635,"Cosechador nocturno":4636,"Abrazo demoníaco":4637,"Piedra de guardianes atenta":4638,"Piedra de visión inquieta":4641,"Espejo de cristal de Bandle":4642,"Piedra de visión vigilante":4643,"Látigo puntahierro":6029,"Amanecer de Meraplata":6035,"Baile de la muerte":6333,"Mecanoespada punki":6609,"Bastón de aguas fluidas":6616,"Renovación de piedra lunar":6617,"Chupasangre":6630,"Cortasendas":6631,"Desgarrador divino":6632,"Desconsuelo de Liandry":6653,"Tempestad de Luden":6655,"Escarcha eterna":6656,"Rescoldo de Bami":6660,"Guantelete de fuego escarchado":6662,"Quimiotanque turbo":6664,"Carcaj del mediodía":6670,"Viento huracanado":6671,"Verdugo de krakens":6672,"Arcoescudo inmortal":6673,"Filoveloz de Navori":6675,"Recaudadora":6676,"Cuchillo de ira":6677,"Filoscuro de Draktharr":6691,"Eclipse":6692,"Garra de merodeador":6693,"Rencor de Serylda":6694,"Colmillo de serpiente":6695}; // includes both en_US and es_ES data
document.ChampionCodes = {"Aatrox":266,"Ahri":103,"Akali":84,"Alistar":12,"Amumu":32,"Anivia":34,"Annie":1,"Aphelios":523,"Ashe":22,"AurelionSol":136,"Azir":268,"Bard":432,"Blitzcrank":53,"Brand":63,"Braum":201,"Caitlyn":51,"Camille":164,"Cassiopeia":69,"Chogath":31,"Corki":42,"Darius":122,"Diana":131,"Draven":119,"DrMundo":36,"Ekko":245,"Elise":60,"Evelynn":28,"Ezreal":81,"Fiddlesticks":9,"Fiora":114,"Fizz":105,"Galio":3,"Gangplank":41,"Garen":86,"Gnar":150,"Gragas":79,"Graves":104,"Hecarim":120,"Heimerdinger":74,"Illaoi":420,"Irelia":39,"Ivern":427,"Janna":40,"JarvanIV":59,"Jax":24,"Jayce":126,"Jhin":202,"Jinx":222,"Kaisa":145,"Kalista":429,"Karma":43,"Karthus":30,"Kassadin":38,"Katarina":55,"Kayle":10,"Kayn":141,"Kennen":85,"Khazix":121,"Kindred":203,"Kled":240,"KogMaw":96,"Leblanc":7,"LeeSin":64,"Leona":89,"Lillia":876,"Lissandra":127,"Lucian":236,"Lulu":117,"Lux":99,"Malphite":54,"Malzahar":90,"Maokai":57,"MasterYi":11,"MissFortune":21,"MonkeyKing":62,"Mordekaiser":82,"Morgana":25,"Nami":267,"Nasus":75,"Nautilus":111,"Neeko":518,"Nidalee":76,"Nocturne":56,"Nunu":20,"Olaf":2,"Orianna":61,"Ornn":516,"Pantheon":80,"Poppy":78,"Pyke":555,"Qiyana":246,"Quinn":133,"Rakan":497,"Rammus":33,"RekSai":421,"Rell":526,"Renekton":58,"Rengar":107,"Riven":92,"Rumble":68,"Ryze":13,"Samira":360,"Sejuani":113,"Senna":235,"Seraphine":147,"Sett":875,"Shaco":35,"Shen":98,"Shyvana":102,"Singed":27,"Sion":14,"Sivir":15,"Skarner":72,"Sona":37,"Soraka":16,"Swain":50,"Sylas":517,"Syndra":134,"TahmKench":223,"Taliyah":163,"Talon":91,"Taric":44,"Teemo":17,"Thresh":412,"Tristana":18,"Trundle":48,"Tryndamere":23,"TwistedFate":4,"Twitch":29,"Udyr":77,"Urgot":6,"Varus":110,"Vayne":67,"Veigar":45,"Velkoz":161,"Vi":254,"Viktor":112,"Vladimir":8,"Volibear":106,"Warwick":19,"Xayah":498,"Xerath":101,"XinZhao":5,"Yasuo":157,"Yone":777,"Yorick":83,"Yuumi":350,"Zac":154,"Zed":238,"Ziggs":115,"Zilean":26,"Zoe":142,"Zyra":143};
document.NeedToAddSpaces = {"AurelionSol":"Aurelion Sol","DrMundo":"Dr. Mundo","JarvanIV":"Jarvan IV","KogMaw":"Kog'Maw","LeeSin":"Lee Sin","MasterYi":"Master Yi","MissFortune":"Miss Fortune","MonkeyKing":"Monkey King","RekSai":"Rek'Sai","TahmKench":"Tahm Kench","XinZhao":"Xin Zhao"};

String.prototype.has=function(findWhat){return this.indexOf(findWhat)!=-1}
String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}
String.prototype.replaceQuotes=function(){return this.replace(/"/g,'\\"')}
String.prototype.removeTags=function(){return this.replace(/<[\D\d]*>/g,"")}
String.prototype.removeSpaces=function(){return this.replace(/\s/g,"")}
String.prototype.removeApostrophe=function(){return this.replace(/'/g,'')}
String.prototype.removeParenthesis=function(){return this.replace(/ \([\D\d]*\)/gi,"")}

// If the item name has " (Trinket)" or anything in parenthesis, make a duplicate entry that has the parenthesis removed. This might not be needed anymore.
for(let k in document.ItemCodes)
	if(k.has("("))
		document.ItemCodes[ k.removeParenthesis() ] = document.ItemCodes[ k ];

document.GatherTheData = function() {

	let URL = document.location.href;
	let Author, ChampionName, Title, ChampionCode;
	if(URL.has("mobafire.com")) {
		Author = document.querySelector("div[class$='top__title']").querySelector("a").innerHTML +" @ "+ document.querySelector("div[class$='top__title']").querySelector("a").href;
		ChampionName = document.getElementById("sidebar-similar-builds").querySelector("h3").innerHTML;
		Title = document.querySelector("div[class$='top__title']").querySelector("h2").innerHTML.removeTags().trim();
		ChampionCode = document.ChampionCodes[ ChampionName.removeSpaces().removeApostrophe() ];

	} else if(URL.has("probuilds.net")) {
		let Highlighted = document.querySelector("td[class$='summoner highlighted']");
		Author = Highlighted.children[0].innerHTML;
		ChampionName = Highlighted.parentElement.children[0].children[0].children[0].attributes["data-id"].value;
		if(document.NeedToAddSpaces[ChampionName])
			ChampionName = document.NeedToAddSpaces[ChampionName];
		Title = ChampionName +" &lt;"+ Author +"&gt;";
		ChampionCode = document.ChampionCodes[ ChampionName ];
	}

	let Output = '{\n\t"title": "'+ Title.replaceQuotes() +'",\n\t"associatedMaps": [],\n\t"associatedChampions": ['+ ChampionCode +'],\n\t"_notes": "'+ URL +'",\n\t"_author": "'+ Author +'",\n\t"blocks": [';
	let GroupName = "", ItemCode, i, j;

	if(URL.has("mobafire.com")) {
		String.prototype.removeUnwantedCharacters=function(){return this.replace(/ - [\D]{1,}/g,"")} // The end of the names of some of Mabafire's items include " - Warrier", " - Runic Echoes", " - Cinderhunk", " - Bloodrazer" and these don't match the names in the https://ddragon.leagueoflegends.com/cdn/10.18.1/data/en_US/item.json
		let Divs = document.querySelectorAll("div.view-guide__items");
		let ItemSpans;
		for(i=0; i<Divs.length; i++) {
			GroupName = Divs[i].children[0].children[0].innerHTML;
			Output += '\n\t\t{\n\t\t\t"type": "'+ GroupName +'",\n\t\t\t"items": [';
			ItemSpans = Divs[i].children[1].children;

			for(j=0; j<ItemSpans.length; j++) {
				ItemCode = document.ItemCodes[ ItemSpans[j].querySelector("span").innerHTML.removeUnwantedCharacters() ];
				Output += '\n\t\t\t\t{ "id": "'+ItemCode+'", "count": 1 }';
				if(j != ItemSpans.length-1)
					Output += ',';
			}
			Output += '\n\t\t\t]\n\t\t}';
			if(i < Divs.length-1)
				Output += ',';
		}
	} else if(URL.has("probuilds.net")) {
		let LIs = document.querySelector("ul.buy-order").children;
		let time, buys = [];

		for(i=0; i<LIs.length; i++) {
			time = LIs[i].children[1].innerHTML.trim();
			if(time.length>9) {
				time = LIs[i].children[2].innerHTML.trim();
				GroupName = "Sold @ "+ time;
			}
			buys.push( {
				ItemCode: LIs[i].children[0].attributes["data-id"].value,
				Time: time
			} );

			if( i==LIs.length-1 || GroupName.has("Sold") || LIs[i+1].className.has("first") ) {
				if(!GroupName) for(j=0; j<buys.length; j++) {
					if(j==0)
						GroupName = buys[j].Time;
					else if(j==buys.length-1)
						GroupName += " ~ "+ buys[j].Time;
				}
				Output += '\n\t\t{\n\t\t\t"type": "'+ GroupName +'",\n\t\t\t"items": [';
				for(j=0; j<buys.length; j++) {
					Output += '\n\t\t\t\t{ "id": "'+ buys[j].ItemCode +'", "count": 1 }';
					if(j != buys.length-1 )
						Output += ',';
				}
				Output += '\n\t\t\t]\n\t\t}';
				if(i < LIs.length-1)
					Output += ',';
				GroupName = "";
				buys = [];
			}
		}
	}

	Output += "\n\t]\n}";
	console.log("============ gathered the data ============");
	return Output;
}

var Button = document.createElement("button");
Button.style = "position:fixed; top:50px; right:7px; z-index:999999; border:0px; background:darkblue; color:#bbcbe8; padding:5px 9px; font-family:'Open Sans Mobafire','Open Sans',sans-serif,sans-serif";
Button.innerHTML = "Items JSON";
Button.onmouseover = function() {
	document.getElementById("TheTextarea").value = document.GatherTheData();
	document.getElementById("TheTextarea").style.visibility = "visible";
}
Button.onclick = function() {
	document.getElementById("TheTextarea").style.visibility = document.getElementById("TheTextarea").style.visibility=="hidden" ? "visible" : "hidden";
}
document.body.appendChild(Button);

var TheTextarea = document.createElement("textarea");
TheTextarea.style = "position:fixed; top:82px; right:7px; z-index:999999; border:2px dashed navy; width:280px; height:420px; background:gainsboro; color:black; font-size:6px; font-family:'Open Sans Mobafire','Open Sans',sans-serif,sans-serif; overflow-x:hidden; visibility:hidden";
TheTextarea.id = "TheTextarea";
TheTextarea.value = document.GatherTheData();
TheTextarea.onmouseover = function() { document.getElementById("TheTextarea").select() }
document.body.appendChild(TheTextarea);

/* THE FOLLOWING IS A REFERENCE FOR HOW I GATHERED THE ITEM AND CHAMPION DATA
 * THE LATEST VERSION OF THE .json FILE NAMES CAN BE FOUND BY GOING HERE https://ddragon.leagueoflegends.com/api/versions.json

// https://ddragon.leagueoflegends.com/cdn/10.25.1/data/en_US/item.json
// https://ddragon.leagueoflegends.com/cdn/10.25.1/data/es_ES/item.json // Spanish version
INPUT = JSON.parse(this.JSONView.json.data).data;
OUTPUT = "document.ItemCodes = {";
for(code in INPUT)
	OUTPUT += '"' + INPUT[code].name + '":' + code + ",";
console.log( OUTPUT.slice(0,-1) + "};" );

// https://ddragon.leagueoflegends.com/cdn/10.25.1/data/en_US/champion.json
// the es_ES version is identical
INPUT = JSON.parse(this.JSONView.json.data).data;
OUTPUT = "document.ChampionCodes = {";
for(name in INPUT)
	OUTPUT += '"' + name + '":' + INPUT[name].key + ",";
console.log( OUTPUT.slice(0,-1) + "};" );

*/